<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create a Memorial Page ‚Äî GentlyTold</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Lato:wght@300;400;700&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Lato', sans-serif;
            background: #0a0a0a;
            color: #e8e0d8;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        a { color: #c4a478; text-decoration: none; }

        /* Header */
        .header {
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(196, 164, 120, 0.08);
        }

        .header-brand {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            color: #c4a478;
        }

        .header-back {
            font-weight: 300;
            font-size: 0.9rem;
            color: #a89880;
        }

        /* ===================== */
        /* Quick Start Section   */
        /* ===================== */
        .quick-start {
            max-width: 700px;
            margin: 3rem auto 0;
            padding: 0 2rem;
        }

        .quick-start-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .quick-start-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: #f5efe8;
            margin-bottom: 0.5rem;
        }

        .quick-start-header p {
            font-weight: 300;
            color: #a89880;
            font-size: 1.05rem;
        }

        /* Path Toggle */
        .path-toggle {
            display: flex;
            gap: 0;
            margin-bottom: 2rem;
            border: 1px solid rgba(196, 164, 120, 0.25);
            border-radius: 10px;
            overflow: hidden;
        }

        .path-toggle-btn {
            flex: 1;
            padding: 1rem 1.25rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            color: #7a7068;
            background: transparent;
            border: none;
            border-right: 1px solid rgba(196, 164, 120, 0.15);
        }

        .path-toggle-btn:last-child { border-right: none; }

        .path-toggle-btn.active {
            color: #c4a478;
            background: rgba(196, 164, 120, 0.12);
        }

        .path-toggle-btn:hover:not(.active) {
            background: rgba(196, 164, 120, 0.05);
            color: #a89880;
        }

        .path-toggle-btn .toggle-icon {
            display: block;
            font-size: 1.5rem;
            margin-bottom: 0.3rem;
        }

        .path-toggle-btn .toggle-label {
            display: block;
            font-size: 0.8rem;
            font-family: 'Lato', sans-serif;
            font-weight: 300;
            margin-top: 0.25rem;
            opacity: 0.7;
        }

        /* Paste Panel */
        .paste-panel {
            margin-bottom: 2rem;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .paste-panel.hidden { display: none; }

        .paste-textarea {
            width: 100%;
            min-height: 220px;
            padding: 1.25rem;
            background: rgba(196, 164, 120, 0.04);
            border: 1px solid rgba(196, 164, 120, 0.25);
            border-radius: 10px;
            color: #e8e0d8;
            font-family: 'Lato', sans-serif;
            font-size: 0.95rem;
            line-height: 1.7;
            outline: none;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .paste-textarea:focus {
            border-color: #c4a478;
        }

        .paste-textarea::placeholder {
            color: #5a5450;
            line-height: 1.7;
        }

        .autofill-btn {
            display: block;
            width: 100%;
            margin-top: 1rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #c4a478, #d4b488);
            border: none;
            border-radius: 8px;
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            color: #0a0a0a;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .autofill-btn:hover {
            background: linear-gradient(135deg, #d4b488, #e4c498);
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(196, 164, 120, 0.3);
        }

        .autofill-btn:active {
            transform: translateY(0);
        }

        .autofill-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .autofill-result {
            margin-top: 1rem;
            padding: 1rem 1.25rem;
            border-radius: 8px;
            font-size: 0.9rem;
            line-height: 1.6;
            display: none;
        }

        .autofill-result.success {
            display: block;
            background: rgba(100, 180, 100, 0.08);
            border: 1px solid rgba(100, 180, 100, 0.25);
            color: #a8d4a8;
        }

        .autofill-result.partial {
            display: block;
            background: rgba(196, 164, 120, 0.08);
            border: 1px solid rgba(196, 164, 120, 0.25);
            color: #c4a478;
        }

        .autofill-result .result-title {
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            margin-bottom: 0.3rem;
        }

        .autofill-result ul {
            padding-left: 1.25rem;
            margin-top: 0.5rem;
        }

        .autofill-result li { margin-bottom: 0.2rem; }

        .proceed-btn {
            display: block;
            width: 100%;
            margin-top: 1rem;
            padding: 1rem;
            background: transparent;
            border: 1px solid #c4a478;
            border-radius: 8px;
            font-family: 'Playfair Display', serif;
            font-size: 1.05rem;
            color: #c4a478;
            cursor: pointer;
            transition: all 0.3s;
        }

        .proceed-btn:hover {
            background: rgba(196, 164, 120, 0.1);
        }

        /* Email Callout */
        .email-callout {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: rgba(196, 164, 120, 0.04);
            border: 1px solid rgba(196, 164, 120, 0.12);
            border-radius: 10px;
            text-align: center;
        }

        .email-callout .callout-divider {
            font-family: 'Playfair Display', serif;
            font-size: 0.85rem;
            color: #5a5450;
            text-transform: uppercase;
            letter-spacing: 0.15rem;
            margin-bottom: 0.75rem;
        }

        .email-callout h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.15rem;
            color: #f5efe8;
            margin-bottom: 0.5rem;
        }

        .email-callout p {
            font-weight: 300;
            font-size: 0.9rem;
            color: #7a7068;
            margin-bottom: 0.75rem;
        }

        .email-callout a.email-link {
            display: inline-block;
            padding: 0.6rem 1.5rem;
            border: 1px solid rgba(196, 164, 120, 0.35);
            border-radius: 6px;
            color: #c4a478;
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .email-callout a.email-link:hover {
            background: rgba(196, 164, 120, 0.1);
            border-color: #c4a478;
        }

        /* Divider */
        .section-divider {
            max-width: 700px;
            margin: 2.5rem auto 0;
            padding: 0 2rem;
            text-align: center;
        }

        .section-divider .divider-line {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: #3a3530;
        }

        .section-divider .divider-line::before,
        .section-divider .divider-line::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(196, 164, 120, 0.1);
        }

        .section-divider .divider-line span {
            font-size: 0.8rem;
            color: #5a5450;
            text-transform: uppercase;
            letter-spacing: 0.15rem;
            white-space: nowrap;
        }

        /* Progress */
        .progress-bar {
            max-width: 700px;
            margin: 2rem auto 1rem;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            position: relative;
        }

        .progress-bar.hidden { display: none; }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 18px;
            left: calc(2rem + 18px);
            right: calc(2rem + 18px);
            height: 1px;
            background: rgba(196, 164, 120, 0.2);
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .progress-step .circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid rgba(196, 164, 120, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Playfair Display', serif;
            font-size: 0.9rem;
            color: #7a7068;
            background: #0a0a0a;
            transition: all 0.3s;
        }

        .progress-step.active .circle {
            border-color: #c4a478;
            color: #c4a478;
            background: rgba(196, 164, 120, 0.1);
        }

        .progress-step.completed .circle {
            border-color: #c4a478;
            color: #0a0a0a;
            background: #c4a478;
        }

        .progress-step .step-label {
            font-size: 0.75rem;
            color: #5a5450;
            margin-top: 0.5rem;
            font-weight: 300;
        }

        .progress-step.active .step-label {
            color: #c4a478;
        }

        .progress-step.completed .step-label {
            color: #a89880;
        }

        /* Form Container */
        .form-container {
            max-width: 700px;
            margin: 2rem auto 4rem;
            padding: 0 2rem;
        }

        .form-container.hidden { display: none; }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        .step-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: #f5efe8;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .step-subtitle {
            text-align: center;
            font-weight: 300;
            color: #a89880;
            margin-bottom: 2.5rem;
            font-size: 0.95rem;
        }

        .autofill-badge {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            background: rgba(100, 180, 100, 0.15);
            border: 1px solid rgba(100, 180, 100, 0.25);
            border-radius: 4px;
            color: #a8d4a8;
            font-family: 'Lato', sans-serif;
            font-size: 0.7rem;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.05rem;
            vertical-align: middle;
            margin-left: 0.5rem;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-family: 'Playfair Display', serif;
            font-size: 0.95rem;
            color: #c4a478;
            margin-bottom: 0.5rem;
        }

        .form-group .hint {
            font-size: 0.8rem;
            font-weight: 300;
            color: #7a7068;
            margin-bottom: 0.5rem;
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group input[type="url"],
        .form-group input[type="date"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem 1rem;
            background: rgba(196, 164, 120, 0.06);
            border: 1px solid rgba(196, 164, 120, 0.25);
            border-radius: 6px;
            color: #e8e0d8;
            font-family: 'Lato', sans-serif;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s, background 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: #c4a478;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #5a5450;
        }

        .form-group select option {
            background: #1a1510;
            color: #e8e0d8;
        }

        /* Highlight auto-filled fields */
        .form-group input.autofilled,
        .form-group textarea.autofilled {
            background: rgba(100, 180, 100, 0.06);
            border-color: rgba(100, 180, 100, 0.3);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group.invalid input,
        .form-group.invalid textarea,
        .form-group.invalid select {
            border-color: #b45050;
        }

        .form-group .error-msg {
            font-size: 0.8rem;
            color: #b45050;
            margin-top: 0.3rem;
            display: none;
        }

        .form-group.invalid .error-msg {
            display: block;
        }

        /* Toggle */
        .toggle-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .toggle-option {
            flex: 1;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(196, 164, 120, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            color: #7a7068;
        }

        .toggle-option.active {
            border-color: #c4a478;
            color: #c4a478;
            background: rgba(196, 164, 120, 0.1);
        }

        .toggle-option:hover {
            border-color: rgba(196, 164, 120, 0.4);
        }

        /* Couple section */
        .couple-fields {
            display: none;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(196, 164, 120, 0.1);
            border-radius: 8px;
            background: rgba(196, 164, 120, 0.02);
        }

        .couple-fields.visible { display: block; }

        .couple-fields h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            color: #c4a478;
            margin-bottom: 1rem;
        }

        /* Timeline builder */
        .timeline-entry {
            display: grid;
            grid-template-columns: 150px 1fr 40px;
            gap: 0.75rem;
            align-items: start;
            margin-bottom: 0.75rem;
        }

        .timeline-entry input,
        .timeline-entry textarea {
            padding: 0.6rem 0.8rem;
            background: rgba(196, 164, 120, 0.06);
            border: 1px solid rgba(196, 164, 120, 0.2);
            border-radius: 4px;
            color: #e8e0d8;
            font-family: 'Lato', sans-serif;
            font-size: 0.9rem;
            outline: none;
        }

        .timeline-entry textarea {
            min-height: 60px;
            resize: vertical;
        }

        .remove-btn {
            width: 36px;
            height: 36px;
            border: 1px solid rgba(180, 80, 80, 0.3);
            background: rgba(180, 80, 80, 0.1);
            border-radius: 4px;
            color: #b45050;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-btn {
            display: inline-block;
            padding: 0.5rem 1.25rem;
            border: 1px solid rgba(196, 164, 120, 0.3);
            background: rgba(196, 164, 120, 0.08);
            border-radius: 4px;
            color: #c4a478;
            cursor: pointer;
            font-family: 'Lato', sans-serif;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .add-btn:hover {
            background: rgba(196, 164, 120, 0.15);
        }

        /* Family members */
        .family-entry {
            display: grid;
            grid-template-columns: 1fr 40px;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .family-entry input {
            padding: 0.6rem 0.8rem;
            background: rgba(196, 164, 120, 0.06);
            border: 1px solid rgba(196, 164, 120, 0.2);
            border-radius: 4px;
            color: #e8e0d8;
            font-family: 'Lato', sans-serif;
            font-size: 0.9rem;
            outline: none;
        }

        /* Photo Upload */
        .upload-zone {
            border: 2px dashed rgba(196, 164, 120, 0.25);
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1.5rem;
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: #c4a478;
            background: rgba(196, 164, 120, 0.05);
        }

        .upload-zone .upload-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .upload-zone h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.15rem;
            color: #f5efe8;
            margin-bottom: 0.5rem;
        }

        .upload-zone p {
            font-weight: 300;
            font-size: 0.9rem;
            color: #7a7068;
        }

        .upload-zone input[type="file"] {
            display: none;
        }

        .photo-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .photo-preview {
            aspect-ratio: 1;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(196, 164, 120, 0.15);
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-preview .remove-photo {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background: rgba(10, 10, 10, 0.8);
            border: 1px solid rgba(180, 80, 80, 0.5);
            border-radius: 50%;
            color: #b45050;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        /* Review */
        .review-section {
            background: rgba(196, 164, 120, 0.04);
            border: 1px solid rgba(196, 164, 120, 0.12);
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .review-section h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.15rem;
            color: #c4a478;
            margin-bottom: 1rem;
        }

        .review-field {
            margin-bottom: 0.75rem;
        }

        .review-field .rf-label {
            font-size: 0.8rem;
            color: #7a7068;
            text-transform: uppercase;
            letter-spacing: 0.1rem;
        }

        .review-field .rf-value {
            font-weight: 300;
            color: #d4ccc4;
            line-height: 1.6;
        }

        /* Buttons */
        .form-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2.5rem;
            gap: 1rem;
        }

        .btn {
            padding: 0.9rem 2rem;
            border-radius: 6px;
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .btn-back {
            background: transparent;
            border: 1px solid rgba(196, 164, 120, 0.3);
            color: #a89880;
        }

        .btn-back:hover {
            border-color: #c4a478;
            color: #c4a478;
        }

        .btn-next {
            background: #c4a478;
            color: #0a0a0a;
            flex: 1;
            max-width: 250px;
        }

        .btn-next:hover {
            background: #d4b488;
        }

        .btn-submit {
            background: #c4a478;
            color: #0a0a0a;
            width: 100%;
            padding: 1.1rem;
            font-size: 1.1rem;
        }

        .btn-submit:hover {
            background: #d4b488;
        }

        /* Success */
        .success-message {
            display: none;
            text-align: center;
            padding: 4rem 2rem;
        }

        .success-message.visible { display: block; }

        .success-message .check {
            font-size: 3rem;
            margin-bottom: 1.5rem;
        }

        .success-message h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: #f5efe8;
            margin-bottom: 1rem;
        }

        .success-message p {
            font-weight: 300;
            color: #a89880;
            line-height: 1.8;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .form-row { grid-template-columns: 1fr; }
            .timeline-entry { grid-template-columns: 1fr; }
            .timeline-entry .remove-btn { justify-self: end; }
            .toggle-group { flex-direction: column; }
            .form-buttons { flex-direction: column-reverse; }
            .btn-next { max-width: 100%; }
            .progress-step .step-label { font-size: 0.65rem; }
            .quick-start-header h1 { font-size: 1.6rem; }
            .path-toggle-btn { padding: 0.75rem 0.5rem; font-size: 0.9rem; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="header">
        <a href="index.html" class="header-brand">GentlyTold</a>
        <a href="index.html" class="header-back">‚Üê Back to home</a>
    </header>

    <!-- ========================== -->
    <!-- Quick Start: Paste Section -->
    <!-- ========================== -->
    <div class="quick-start" id="quickStart">
        <div class="quick-start-header">
            <h1>Create a Memorial Page</h1>
            <p>The fastest way? Paste the obituary and we'll do the rest.</p>
        </div>

        <!-- Path Toggle -->
        <div class="path-toggle">
            <button class="path-toggle-btn active" onclick="setPath('paste')" id="pathPaste">
                <span class="toggle-icon">üìã</span>
                Paste an Obituary
                <span class="toggle-label">Auto-fill the form in one click</span>
            </button>
            <button class="path-toggle-btn" onclick="setPath('manual')" id="pathManual">
                <span class="toggle-icon">‚úèÔ∏è</span>
                Start from Scratch
                <span class="toggle-label">Fill out each field manually</span>
            </button>
        </div>

        <!-- Paste Panel -->
        <div class="paste-panel" id="pastePanel">
            <textarea class="paste-textarea" id="obituaryText" placeholder="Paste the full obituary text here...

Example:
John David Smith, age 85, of Fort White, Florida, passed away peacefully on January 10, 2026. Born on March 15, 1940, in Jacksonville, FL, John was a beloved father, grandfather, and friend to all who knew him..."></textarea>

            <button class="autofill-btn" id="autofillBtn" onclick="parseObituary()">
                ‚ú® Auto-Fill From Obituary
            </button>

            <div class="autofill-result" id="autofillResult"></div>

            <button class="proceed-btn" id="proceedBtn" style="display: none;" onclick="proceedToReview()">
                Review & Complete ‚Üí
            </button>
        </div>

        <!-- Email Callout -->
        <div class="email-callout">
            <div class="callout-divider">‚Äî or ‚Äî</div>
            <h3>Want us to handle everything?</h3>
            <p>Just email us the obituary and any photos. We'll build the entire memorial page for you ‚Äî no form needed.</p>
            <a href="mailto:hello@gentlytold.com?subject=Memorial%20Page%20Request" class="email-link">
                ‚úâ hello@gentlytold.com
            </a>
        </div>
    </div>

    <!-- Divider between quick-start and form -->
    <div class="section-divider" id="sectionDivider">
        <div class="divider-line">
            <span id="dividerText">Paste above, or fill out the form below</span>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar">
        <div class="progress-step active" data-step="1">
            <div class="circle">1</div>
            <div class="step-label">Basic Info</div>
        </div>
        <div class="progress-step" data-step="2">
            <div class="circle">2</div>
            <div class="step-label">Life Story</div>
        </div>
        <div class="progress-step" data-step="3">
            <div class="circle">3</div>
            <div class="step-label">Photos & Branding</div>
        </div>
        <div class="progress-step" data-step="4">
            <div class="circle">4</div>
            <div class="step-label">Review</div>
        </div>
    </div>

    <!-- Form -->
    <div class="form-container" id="formContainer">

        <!-- Step 1: Basic Info -->
        <div class="step-content active" data-step="1">
            <h2 class="step-title">Basic Information</h2>
            <p class="step-subtitle" id="step1Subtitle">Tell us about the person (or couple) being honored.</p>

            <label class="form-group" style="font-family: 'Playfair Display', serif; color: #c4a478; font-size: 0.95rem; margin-bottom: 0.75rem;">Memorial Type</label>
            <div class="toggle-group">
                <div class="toggle-option active" data-value="individual" onclick="setType('individual')">Individual</div>
                <div class="toggle-option" data-value="couple" onclick="setType('couple')">Couple</div>
            </div>

            <div class="form-group">
                <label>Full Name <span id="person1Label"></span></label>
                <input type="text" id="personName1" placeholder="e.g. John David Smith" required>
                <div class="error-msg">Please enter the full name</div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Date of Birth</label>
                    <input type="text" id="personBorn1" placeholder="e.g. March 15, 1940">
                    <div class="error-msg">Please enter the date of birth</div>
                </div>
                <div class="form-group">
                    <label>Date of Passing</label>
                    <input type="text" id="personDied1" placeholder="e.g. January 10, 2026">
                    <div class="error-msg">Please enter the date of passing</div>
                </div>
            </div>

            <div class="form-group">
                <label>Location</label>
                <input type="text" id="location1" placeholder="e.g. Fort White, Florida">
            </div>

            <!-- Couple Fields -->
            <div class="couple-fields" id="coupleFields">
                <h3>Second Person</h3>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="personName2" placeholder="e.g. Mary Jane Smith">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="text" id="personBorn2" placeholder="e.g. June 22, 1942">
                    </div>
                    <div class="form-group">
                        <label>Date of Passing</label>
                        <input type="text" id="personDied2" placeholder="e.g. January 13, 2026">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Hero Quote (optional)</label>
                <div class="hint">A short quote or phrase that captures their essence</div>
                <input type="text" id="heroQuote" placeholder="e.g. They lived as one, and in the end, not even death could part them.">
            </div>

            <div class="form-buttons">
                <div></div>
                <button class="btn btn-next" onclick="nextStep(2)">Continue ‚Üí</button>
            </div>
        </div>

        <!-- Step 2: Life Story -->
        <div class="step-content" data-step="2">
            <h2 class="step-title">Life Story</h2>
            <p class="step-subtitle">Share their story. Edit what was auto-filled, or write something new.</p>

            <div class="form-group">
                <label>Their Story</label>
                <div class="hint">Write the life story, or paste an existing obituary. We'll format it beautifully.</div>
                <textarea id="storyText" rows="8" placeholder="The night they met, Gloria had dates lined up with a few different guys. Jerry was the first one to show up ‚Äî so he got to take her out..."></textarea>
            </div>

            <div class="form-group">
                <label>Timeline Events</label>
                <div class="hint">Key moments in their life. Add as many as you like.</div>
                <div id="timelineEntries">
                    <div class="timeline-entry">
                        <input type="text" placeholder="Year / Label" class="tl-year">
                        <textarea placeholder="What happened..." class="tl-text"></textarea>
                        <button class="remove-btn" onclick="removeEntry(this, 'timelineEntries')" title="Remove">√ó</button>
                    </div>
                </div>
                <button class="add-btn" onclick="addTimeline()">+ Add Event</button>
            </div>

            <div class="form-group">
                <label>Family Members</label>
                <div class="hint">Children, grandchildren, or other close family to list.</div>
                <div id="familyEntries">
                    <div class="family-entry">
                        <input type="text" placeholder="Name" class="fm-name">
                        <button class="remove-btn" onclick="removeEntry(this, 'familyEntries')" title="Remove">√ó</button>
                    </div>
                </div>
                <button class="add-btn" onclick="addFamily()">+ Add Family Member</button>
            </div>

            <div class="form-group">
                <label>Family Note (optional)</label>
                <input type="text" id="familyNote" placeholder="e.g. Their son Michael preceded them in passing.">
            </div>

            <div class="form-group">
                <label>Closing Quote (optional)</label>
                <input type="text" id="closingQuote" placeholder="e.g. Some people leave footprints so deep in our hearts...">
            </div>

            <div class="form-buttons">
                <button class="btn btn-back" onclick="prevStep(1)">‚Üê Back</button>
                <button class="btn btn-next" onclick="nextStep(3)">Continue ‚Üí</button>
            </div>
        </div>

        <!-- Step 3: Photos & Branding -->
        <div class="step-content" data-step="3">
            <h2 class="step-title">Photos & Branding</h2>
            <p class="step-subtitle">Upload photos and add your funeral home details.</p>

            <div class="form-group">
                <label>Photos</label>
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">üì∑</div>
                    <h3>Drag & drop photos here</h3>
                    <p>or click to browse ¬∑ JPG, PNG, WEBP</p>
                    <input type="file" id="photoInput" multiple accept="image/*">
                </div>
                <div class="photo-preview-grid" id="photoPreview"></div>
            </div>

            <div style="border-top: 1px solid rgba(196, 164, 120, 0.1); padding-top: 2rem; margin-top: 1rem;">
                <h3 style="font-family: 'Playfair Display', serif; color: #c4a478; font-size: 1.15rem; margin-bottom: 1.5rem;">Funeral Home Branding</h3>

                <div class="form-group">
                    <label>Funeral Home Name</label>
                    <input type="text" id="funeralHomeName" placeholder="e.g. Daniels Funeral Home">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" id="funeralHomePhone" placeholder="(386) 362-4333">
                    </div>
                    <div class="form-group">
                        <label>Website</label>
                        <input type="url" id="funeralHomeWebsite" placeholder="https://www.yourfuneralhome.com">
                    </div>
                </div>

                <div class="form-group">
                    <label>Tagline (optional)</label>
                    <input type="text" id="funeralHomeTagline" placeholder="e.g. Serving families with compassion since 1950">
                </div>

                <div class="form-group">
                    <label>Logo Upload (optional)</label>
                    <div class="upload-zone" id="logoZone" style="padding: 1.5rem;">
                        <p style="color: #7a7068;">Click to upload logo ¬∑ PNG or SVG preferred</p>
                        <input type="file" id="logoInput" accept="image/*">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Contact Email</label>
                <div class="hint">Where should memory submissions from visitors be sent?</div>
                <input type="email" id="formEmail" placeholder="you@funeralhome.com">
            </div>

            <div class="form-buttons">
                <button class="btn btn-back" onclick="prevStep(2)">‚Üê Back</button>
                <button class="btn btn-next" onclick="nextStep(4)">Review ‚Üí</button>
            </div>
        </div>

        <!-- Step 4: Review -->
        <div class="step-content" data-step="4">
            <h2 class="step-title">Review & Submit</h2>
            <p class="step-subtitle">Make sure everything looks right before submitting.</p>

            <div id="reviewContent"></div>

            <div style="margin-top: 2rem;">
                <button class="btn btn-submit" onclick="submitForm()">Submit Memorial Request</button>
            </div>

            <div class="form-buttons" style="margin-top: 1rem;">
                <button class="btn btn-back" onclick="prevStep(3)">‚Üê Back to edit</button>
                <div></div>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div class="success-message" id="successMessage">
        <div class="check">‚ú¶</div>
        <h2>Memorial Request Submitted</h2>
        <p>
            Thank you. We've received everything we need to create a beautiful memorial page.
            You'll receive a preview within 24 hours at the email provided.
        </p>
        <p style="margin-top: 2rem;">
            <a href="index.html" style="color: #c4a478;">‚Üê Return to GentlyTold</a>
        </p>
    </div>

    <script>
        // --- State ---
        let currentStep = 1;
        let memorialType = 'individual';
        let uploadedPhotos = [];
        let uploadedLogo = null;
        let wasAutofilled = false;

        // ===========================
        // PATH TOGGLE (paste vs manual)
        // ===========================
        function setPath(path) {
            document.getElementById('pathPaste').classList.toggle('active', path === 'paste');
            document.getElementById('pathManual').classList.toggle('active', path === 'manual');
            document.getElementById('pastePanel').classList.toggle('hidden', path !== 'paste');

            if (path === 'manual') {
                document.getElementById('dividerText').textContent = 'Fill out the form below';
                // Scroll to the form
                document.getElementById('progressBar').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                document.getElementById('dividerText').textContent = 'Paste above, or fill out the form below';
            }
        }

        // ===========================
        // OBITUARY PARSER
        // ===========================
        function parseObituary() {
            const text = document.getElementById('obituaryText').value.trim();
            if (!text) {
                alert('Please paste an obituary first.');
                return;
            }

            const btn = document.getElementById('autofillBtn');
            btn.disabled = true;
            btn.textContent = 'Parsing...';

            // Slight delay for visual feedback
            setTimeout(() => {
                try {
                    const result = extractFromObituary(text);
                    applyExtraction(result);
                    showResult(result);
                } catch (e) {
                    console.error('Parse error:', e);
                    showResult({ filled: [], missed: ['Could not parse ‚Äî please fill out the form manually.'] });
                }
                btn.disabled = false;
                btn.textContent = '‚ú® Auto-Fill From Obituary';
            }, 400);
        }

        function extractFromObituary(text) {
            const result = {
                name: null,
                birthDate: null,
                deathDate: null,
                location: null,
                age: null,
                story: null,
                familyMembers: [],
                familyNote: null,
                heroQuote: null,
                closingQuote: null,
                timelineEvents: [],
                isCouple: false,
                name2: null,
                birthDate2: null,
                deathDate2: null,
                filled: [],
                missed: []
            };

            const lines = text.split('\n').map(l => l.trim()).filter(l => l);

            // --- NAME extraction ---
            // Pattern: "FirstName MiddleName LastName, age XX"
            // Pattern: "FirstName MiddleName LastName, XX, of City"
            // Pattern: Just the first line if it looks like a name
            const nameAgeMatch = text.match(/^([A-Z][a-zA-Z]+(?:\s+(?:[A-Z]\.?\s*)?[a-zA-Z]+){1,4})\s*,\s*(?:age\s+)?(\d{2,3})/im);
            const nameOfMatch = text.match(/^([A-Z][a-zA-Z]+(?:\s+(?:[A-Z]\.?\s*)?[a-zA-Z]+){1,4})\s*,\s*(?:\d{2,3}\s*,\s*)?of\s+([A-Za-z\s]+(?:,\s*[A-Za-z\s]+)?)/im);
            const namePassedMatch = text.match(/([A-Z][a-zA-Z]+(?:\s+(?:[A-Z]\.?\s*)?[a-zA-Z]+){1,4})\s*(?:,\s*(?:age\s+)?\d{2,3}\s*,?\s*)?(?:passed away|died|went home|entered into rest|departed|transitioned)/i);
            const nameBornMatch = text.match(/([A-Z][a-zA-Z]+(?:\s+(?:[A-Z]\.?\s*)?[a-zA-Z]+){1,4})\s*(?:was\s+)?born/i);

            if (nameAgeMatch) {
                result.name = nameAgeMatch[1].trim();
                result.age = nameAgeMatch[2];
            } else if (nameOfMatch) {
                result.name = nameOfMatch[1].trim();
            } else if (namePassedMatch) {
                result.name = namePassedMatch[1].trim();
            } else if (nameBornMatch) {
                result.name = nameBornMatch[1].trim();
            }

            if (result.name) {
                result.filled.push('Name');
            } else {
                result.missed.push('Name');
            }

            // --- LOCATION ---
            if (nameOfMatch && nameOfMatch[2]) {
                result.location = nameOfMatch[2].trim().replace(/\s*,?\s*$/, '');
                result.filled.push('Location');
            } else {
                const locMatch = text.match(/of\s+([A-Z][a-zA-Z\s]+,\s*[A-Z]{2}|[A-Z][a-zA-Z\s]+,\s*[A-Z][a-zA-Z]+)/);
                if (locMatch) {
                    result.location = locMatch[1].trim();
                    result.filled.push('Location');
                } else {
                    result.missed.push('Location');
                }
            }

            // --- DATES ---
            // Common date formats
            const datePattern = /(?:January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{1,2}(?:st|nd|rd|th)?,?\s*\d{4}/gi;
            const shortDatePattern = /\d{1,2}\/\d{1,2}\/\d{2,4}/g;

            // Death date patterns
            const deathPatterns = [
                /passed\s+away\s+(?:peacefully\s+)?(?:on\s+)?([A-Z][a-z]+\s+\d{1,2}(?:st|nd|rd|th)?,?\s*\d{4})/i,
                /died\s+(?:on\s+)?([A-Z][a-z]+\s+\d{1,2}(?:st|nd|rd|th)?,?\s*\d{4})/i,
                /(?:on|dated?)\s+([A-Z][a-z]+\s+\d{1,2}(?:st|nd|rd|th)?,?\s*\d{4})\s*[,.]?\s*(?:at|in|surrounded)/i,
                /(?:January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{1,2}(?:st|nd|rd|th)?,?\s*\d{4}\s*[-‚Äì‚Äî]\s*([A-Z][a-z]+\s+\d{1,2}(?:st|nd|rd|th)?,?\s*\d{4})/i,
            ];

            for (const pat of deathPatterns) {
                const m = text.match(pat);
                if (m) {
                    result.deathDate = m[1].replace(/(\d+)(?:st|nd|rd|th)/i, '$1');
                    break;
                }
            }

            // Birth date patterns
            const birthPatterns = [
                /born\s+(?:on\s+)?([A-Z][a-z]+\s+\d{1,2}(?:st|nd|rd|th)?,?\s*\d{4})/i,
                /born\s+(?:on\s+)?(?:in\s+[A-Za-z\s,]+\s+on\s+)?([A-Z][a-z]+\s+\d{1,2}(?:st|nd|rd|th)?,?\s*\d{4})/i,
                /([A-Z][a-z]+\s+\d{1,2}(?:st|nd|rd|th)?,?\s*\d{4})\s*[-‚Äì‚Äî]\s*[A-Z][a-z]+\s+\d{1,2}/i,
            ];

            for (const pat of birthPatterns) {
                const m = text.match(pat);
                if (m) {
                    result.birthDate = m[1].replace(/(\d+)(?:st|nd|rd|th)/i, '$1');
                    break;
                }
            }

            // Also try "Month Day, Year ‚Äì Month Day, Year" pattern in parens or after name
            if (!result.birthDate || !result.deathDate) {
                const rangeMatch = text.match(/\(?\s*([A-Z][a-z]+\s+\d{1,2},?\s*\d{4})\s*[-‚Äì‚Äî]\s*([A-Z][a-z]+\s+\d{1,2},?\s*\d{4})\s*\)?/);
                if (rangeMatch) {
                    if (!result.birthDate) result.birthDate = rangeMatch[1].trim();
                    if (!result.deathDate) result.deathDate = rangeMatch[2].trim();
                }
            }

            if (result.birthDate) result.filled.push('Date of Birth');
            else result.missed.push('Date of Birth');
            if (result.deathDate) result.filled.push('Date of Passing');
            else result.missed.push('Date of Passing');

            // --- FAMILY MEMBERS (survived by section) ---
            const survivedMatch = text.match(/(?:survived by|leaves behind|is survived by|survivors include|cherished by)[:\s]*([\s\S]*?)(?=\n\s*\n|(?:preceded in death|predeceased|funeral|memorial|service|in lieu|visitation|celebration of life|arrangements|the family|pallbearers|a\s+(?:memorial|funeral|celebration)))/i);
            if (survivedMatch) {
                const survivedText = survivedMatch[1];
                // Extract names ‚Äî look for patterns like "his/her/their son, Name" or just names after relationship words
                const familyPattern = /(?:son|daughter|brother|sister|wife|husband|grandson|granddaughter|grandchild|niece|nephew|mother|father|aunt|uncle)[s]?\s*[,:]?\s*([A-Z][a-zA-Z]+(?:\s+[A-Z][a-zA-Z]+){0,3})/gi;
                let famMatch;
                const seen = new Set();
                while ((famMatch = familyPattern.exec(survivedText)) !== null) {
                    const name = famMatch[1].trim();
                    if (!seen.has(name.toLowerCase()) && name.length > 2) {
                        seen.add(name.toLowerCase());
                        result.familyMembers.push(name);
                    }
                }

                // Also try semicolon-separated list approach
                if (result.familyMembers.length === 0) {
                    const parts = survivedText.split(/[;]/);
                    for (const part of parts) {
                        const nameInPart = part.match(/([A-Z][a-zA-Z]+(?:\s+[A-Z][a-zA-Z]+){0,3})/);
                        if (nameInPart) {
                            const n = nameInPart[1].trim();
                            if (!seen.has(n.toLowerCase()) && n.length > 2) {
                                seen.add(n.toLowerCase());
                                result.familyMembers.push(n);
                            }
                        }
                    }
                }
            }

            if (result.familyMembers.length > 0) {
                result.filled.push('Family Members (' + result.familyMembers.length + ')');
            } else {
                result.missed.push('Family Members');
            }

            // --- PRECEDED IN DEATH (family note) ---
            const precededMatch = text.match(/(?:preceded in death|predeceased)\s+by[:\s]*([\s\S]*?)(?=\.\s*[A-Z]|\n\s*\n|$)/i);
            if (precededMatch) {
                result.familyNote = 'Preceded in death by ' + precededMatch[1].trim().replace(/\.$/, '');
                result.filled.push('Family Note');
            }

            // --- STORY TEXT ---
            // The story is typically the middle section ‚Äî after the intro paragraph (name/dates)
            // and before the "survived by" section
            const paragraphs = text.split(/\n\s*\n/);
            const storyParagraphs = [];

            for (let i = 0; i < paragraphs.length; i++) {
                const p = paragraphs[i].trim();
                if (!p) continue;
                // Skip if it's clearly the header/intro line (has name + dates + passed away)
                if (i === 0 && /(?:passed away|died|born|age\s+\d)/i.test(p) && p.length < 500) continue;
                // Skip survived by sections
                if (/(?:survived by|leaves behind|preceded in death|pallbearer|funeral|memorial service|visitation|in lieu of|arrangements|celebration of life)/i.test(p)) continue;
                // Skip short service-detail lines
                if (p.length < 40 && /(?:funeral|memorial|visitation|cemetery|church)/i.test(p)) continue;
                storyParagraphs.push(p);
            }

            if (storyParagraphs.length > 0) {
                result.story = storyParagraphs.join('\n\n');
                result.filled.push('Life Story');
            } else {
                // Fallback: use the whole text as story
                result.story = text;
                result.filled.push('Life Story (full text)');
            }

            // --- TIMELINE extraction ---
            // Look for year references in the text
            const yearMentions = text.match(/(?:in\s+)(\d{4})[,.\s]/gi);
            if (yearMentions && yearMentions.length > 0) {
                // Extract sentences containing years
                const sentences = text.split(/[.!?]+/);
                const seenYears = new Set();
                for (const sentence of sentences) {
                    const yearInSentence = sentence.match(/(?:in\s+)?(\d{4})/);
                    if (yearInSentence) {
                        const year = yearInSentence[1];
                        const yearNum = parseInt(year);
                        if (yearNum >= 1900 && yearNum <= 2030 && !seenYears.has(year)) {
                            seenYears.add(year);
                            const cleanSentence = sentence.trim();
                            if (cleanSentence.length > 15 && cleanSentence.length < 300) {
                                result.timelineEvents.push({ year: year, text: cleanSentence });
                            }
                        }
                    }
                }
                // Limit to 8 events
                result.timelineEvents = result.timelineEvents.slice(0, 8);
                if (result.timelineEvents.length > 0) {
                    result.filled.push('Timeline Events (' + result.timelineEvents.length + ')');
                }
            }

            // --- QUOTES ---
            // Look for text in quotes
            const quoteMatches = text.match(/"([^"]{10,200})"/g);
            if (quoteMatches && quoteMatches.length > 0) {
                result.heroQuote = quoteMatches[0].replace(/"/g, '');
                result.filled.push('Quote');
                if (quoteMatches.length > 1) {
                    result.closingQuote = quoteMatches[quoteMatches.length - 1].replace(/"/g, '');
                }
            }

            return result;
        }

        function applyExtraction(result) {
            wasAutofilled = true;

            function setField(id, value) {
                if (value) {
                    const el = document.getElementById(id);
                    if (el) {
                        el.value = value;
                        el.classList.add('autofilled');
                    }
                }
            }

            setField('personName1', result.name);
            setField('personBorn1', result.birthDate);
            setField('personDied1', result.deathDate);
            setField('location1', result.location);
            setField('storyText', result.story);
            setField('heroQuote', result.heroQuote);
            setField('closingQuote', result.closingQuote);
            setField('familyNote', result.familyNote);

            // Couple detection
            if (result.isCouple) {
                setType('couple');
                setField('personName2', result.name2);
                setField('personBorn2', result.birthDate2);
                setField('personDied2', result.deathDate2);
            }

            // Family members
            if (result.familyMembers.length > 0) {
                const container = document.getElementById('familyEntries');
                container.innerHTML = '';
                result.familyMembers.forEach(name => {
                    const entry = document.createElement('div');
                    entry.className = 'family-entry';
                    entry.innerHTML = `
                        <input type="text" placeholder="Name" class="fm-name" value="${escHtml(name)}">
                        <button class="remove-btn" onclick="removeEntry(this, 'familyEntries')" title="Remove">√ó</button>
                    `;
                    container.appendChild(entry);
                });
            }

            // Timeline events
            if (result.timelineEvents.length > 0) {
                const container = document.getElementById('timelineEntries');
                container.innerHTML = '';
                result.timelineEvents.forEach(event => {
                    const entry = document.createElement('div');
                    entry.className = 'timeline-entry';
                    entry.innerHTML = `
                        <input type="text" placeholder="Year / Label" class="tl-year" value="${escHtml(event.year)}">
                        <textarea placeholder="What happened..." class="tl-text">${escHtml(event.text)}</textarea>
                        <button class="remove-btn" onclick="removeEntry(this, 'timelineEntries')" title="Remove">√ó</button>
                    `;
                    container.appendChild(entry);
                });
            }
        }

        function showResult(result) {
            const el = document.getElementById('autofillResult');
            const proceedBtn = document.getElementById('proceedBtn');

            if (result.filled.length === 0) {
                el.className = 'autofill-result partial';
                el.innerHTML = `
                    <div class="result-title">‚ö†Ô∏è Couldn't extract much from this text</div>
                    <p>The obituary format wasn't recognized. You can still fill out the form below ‚Äî the full text has been added to the Life Story field.</p>
                `;
                proceedBtn.style.display = 'block';
                return;
            }

            let html = '';
            if (result.missed.length === 0) {
                el.className = 'autofill-result success';
                html += '<div class="result-title">‚úÖ All fields auto-filled!</div>';
            } else {
                el.className = 'autofill-result success';
                html += '<div class="result-title">‚úÖ Auto-filled ' + result.filled.length + ' fields</div>';
            }

            html += '<ul>';
            result.filled.forEach(f => {
                html += '<li>‚úì ' + f + '</li>';
            });
            result.missed.forEach(f => {
                html += '<li style="color: #a89880;">‚óã ' + f + ' ‚Äî please fill in manually</li>';
            });
            html += '</ul>';

            if (result.missed.length > 0) {
                html += '<p style="margin-top: 0.5rem; font-size: 0.85rem; opacity: 0.7;">Review the form below to fill in any missing fields and check what was extracted.</p>';
            }

            el.innerHTML = html;
            proceedBtn.style.display = 'block';
        }

        function proceedToReview() {
            // Update subtitle to indicate review mode
            document.getElementById('step1Subtitle').innerHTML = 'Review the auto-filled information below. <span class="autofill-badge">Auto-Filled</span>';

            // Scroll to the form
            document.getElementById('progressBar').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // --- Type Toggle ---
        function setType(type) {
            memorialType = type;
            document.querySelectorAll('.toggle-option').forEach(el => {
                el.classList.toggle('active', el.dataset.value === type);
            });
            document.getElementById('coupleFields').classList.toggle('visible', type === 'couple');
            document.getElementById('person1Label').textContent = type === 'couple' ? '(Person 1)' : '';
        }

        // --- Navigation ---
        function nextStep(step) {
            if (!validateStep(currentStep)) return;
            if (step === 4) buildReview();
            goToStep(step);
        }

        function prevStep(step) {
            goToStep(step);
        }

        function goToStep(step) {
            currentStep = step;
            document.querySelectorAll('.step-content').forEach(el => {
                el.classList.toggle('active', parseInt(el.dataset.step) === step);
            });
            document.querySelectorAll('.progress-step').forEach(el => {
                const s = parseInt(el.dataset.step);
                el.classList.toggle('active', s === step);
                el.classList.toggle('completed', s < step);
            });
            window.scrollTo({ top: document.getElementById('progressBar').offsetTop - 20, behavior: 'smooth' });
        }

        // --- Validation ---
        function validateStep(step) {
            let valid = true;
            if (step === 1) {
                valid = validateField('personName1') && valid;
            }
            return valid;
        }

        function validateField(id) {
            const el = document.getElementById(id);
            const group = el.closest('.form-group');
            if (!el.value.trim()) {
                group.classList.add('invalid');
                return false;
            }
            group.classList.remove('invalid');
            return true;
        }

        // Clear validation on input
        document.addEventListener('input', e => {
            const group = e.target.closest('.form-group');
            if (group) group.classList.remove('invalid');
            // Remove autofilled highlight when user edits
            if (e.target.classList.contains('autofilled')) {
                e.target.classList.remove('autofilled');
            }
        });

        // --- Dynamic Fields ---
        function addTimeline() {
            const container = document.getElementById('timelineEntries');
            const entry = document.createElement('div');
            entry.className = 'timeline-entry';
            entry.innerHTML = `
                <input type="text" placeholder="Year / Label" class="tl-year">
                <textarea placeholder="What happened..." class="tl-text"></textarea>
                <button class="remove-btn" onclick="removeEntry(this, 'timelineEntries')" title="Remove">√ó</button>
            `;
            container.appendChild(entry);
        }

        function addFamily() {
            const container = document.getElementById('familyEntries');
            const entry = document.createElement('div');
            entry.className = 'family-entry';
            entry.innerHTML = `
                <input type="text" placeholder="Name" class="fm-name">
                <button class="remove-btn" onclick="removeEntry(this, 'familyEntries')" title="Remove">√ó</button>
            `;
            container.appendChild(entry);
        }

        function removeEntry(btn, containerId) {
            const container = document.getElementById(containerId);
            if (container.children.length > 1) {
                btn.closest('.timeline-entry, .family-entry').remove();
            }
        }

        // --- Photo Upload ---
        const uploadZone = document.getElementById('uploadZone');
        const photoInput = document.getElementById('photoInput');
        const logoZone = document.getElementById('logoZone');
        const logoInput = document.getElementById('logoInput');

        uploadZone.addEventListener('click', () => photoInput.click());
        uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('dragover'); });
        uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
        uploadZone.addEventListener('drop', e => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handlePhotos(e.dataTransfer.files);
        });
        photoInput.addEventListener('change', e => handlePhotos(e.target.files));

        logoZone.addEventListener('click', () => logoInput.click());
        logoInput.addEventListener('change', e => {
            if (e.target.files[0]) {
                uploadedLogo = e.target.files[0];
                logoZone.querySelector('p').textContent = '‚úì ' + uploadedLogo.name;
                logoZone.querySelector('p').style.color = '#c4a478';
            }
        });

        function handlePhotos(files) {
            Array.from(files).forEach(file => {
                if (!file.type.startsWith('image/')) return;
                uploadedPhotos.push(file);
                const reader = new FileReader();
                reader.onload = e => {
                    const grid = document.getElementById('photoPreview');
                    const div = document.createElement('div');
                    div.className = 'photo-preview';
                    const idx = uploadedPhotos.length - 1;
                    div.innerHTML = `
                        <img src="${e.target.result}" alt="Upload">
                        <button class="remove-photo" onclick="removePhoto(${idx}, this)" title="Remove">√ó</button>
                    `;
                    grid.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }

        function removePhoto(idx, btn) {
            uploadedPhotos[idx] = null;
            btn.closest('.photo-preview').remove();
        }

        // --- Build Review ---
        function buildReview() {
            const val = id => (document.getElementById(id)?.value || '').trim();
            let html = '';

            // Basic info
            html += '<div class="review-section"><h3>Basic Information</h3>';
            html += reviewField('Type', memorialType === 'couple' ? 'Couple' : 'Individual');
            html += reviewField('Name', val('personName1'));
            html += reviewField('Born ‚Äî Passed', val('personBorn1') + ' ‚Äî ' + val('personDied1'));
            if (val('location1')) html += reviewField('Location', val('location1'));
            if (memorialType === 'couple') {
                html += reviewField('Name (2)', val('personName2'));
                html += reviewField('Born ‚Äî Passed (2)', val('personBorn2') + ' ‚Äî ' + val('personDied2'));
            }
            if (val('heroQuote')) html += reviewField('Hero Quote', val('heroQuote'));
            html += '</div>';

            // Story
            html += '<div class="review-section"><h3>Life Story</h3>';
            if (val('storyText')) html += reviewField('Story', val('storyText').substring(0, 200) + (val('storyText').length > 200 ? '...' : ''));

            const tlEntries = document.querySelectorAll('#timelineEntries .timeline-entry');
            let tlCount = 0;
            tlEntries.forEach(entry => {
                if (entry.querySelector('.tl-year').value.trim()) tlCount++;
            });
            if (tlCount > 0) html += reviewField('Timeline Events', tlCount + ' events');

            const fmEntries = document.querySelectorAll('#familyEntries .family-entry');
            const familyNames = [];
            fmEntries.forEach(entry => {
                const n = entry.querySelector('.fm-name').value.trim();
                if (n) familyNames.push(n);
            });
            if (familyNames.length > 0) html += reviewField('Family', familyNames.join(', '));
            if (val('familyNote')) html += reviewField('Family Note', val('familyNote'));
            if (val('closingQuote')) html += reviewField('Closing Quote', val('closingQuote'));
            html += '</div>';

            // Photos & Branding
            html += '<div class="review-section"><h3>Photos & Branding</h3>';
            const photoCount = uploadedPhotos.filter(p => p !== null).length;
            html += reviewField('Photos', photoCount + ' photo(s) uploaded');
            if (val('funeralHomeName')) html += reviewField('Funeral Home', val('funeralHomeName'));
            if (val('funeralHomePhone')) html += reviewField('Phone', val('funeralHomePhone'));
            if (val('funeralHomeWebsite')) html += reviewField('Website', val('funeralHomeWebsite'));
            if (val('formEmail')) html += reviewField('Contact Email', val('formEmail'));
            html += '</div>';

            document.getElementById('reviewContent').innerHTML = html;
        }

        function reviewField(label, value) {
            if (!value) return '';
            return `<div class="review-field"><div class="rf-label">${label}</div><div class="rf-value">${escHtml(value)}</div></div>`;
        }

        function escHtml(s) {
            return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        // --- Submit ---
        function submitForm() {
            const val = id => (document.getElementById(id)?.value || '').trim();
            
            // Gather timeline
            const timelineItems = [];
            document.querySelectorAll('#timelineEntries .timeline-entry').forEach(entry => {
                const year = entry.querySelector('.tl-year').value.trim();
                const text = entry.querySelector('.tl-text').value.trim();
                if (year || text) timelineItems.push({ year, text });
            });

            // Gather family
            const familyMembers = [];
            document.querySelectorAll('#familyEntries .family-entry').forEach(entry => {
                const name = entry.querySelector('.fm-name').value.trim();
                if (name) familyMembers.push(name);
            });

            const data = {
                isCouple: memorialType === 'couple',
                personName1: val('personName1'),
                personBorn1: val('personBorn1'),
                personDied1: val('personDied1'),
                location1: val('location1'),
                personName2: memorialType === 'couple' ? val('personName2') : '',
                personBorn2: memorialType === 'couple' ? val('personBorn2') : '',
                personDied2: memorialType === 'couple' ? val('personDied2') : '',
                heroQuote: val('heroQuote'),
                storyText: val('storyText'),
                timelineItems,
                familyMembers,
                familyNote: val('familyNote'),
                closingQuote: val('closingQuote'),
                funeralHomeName: val('funeralHomeName'),
                funeralHomePhone: val('funeralHomePhone'),
                funeralHomeWebsite: val('funeralHomeWebsite'),
                funeralHomeTagline: val('funeralHomeTagline'),
                formEmail: val('formEmail'),
                photoCount: uploadedPhotos.filter(p => p !== null).length,
                hasLogo: !!uploadedLogo,
                wasAutofilled: wasAutofilled,
                submittedAt: new Date().toISOString()
            };

            console.log('Memorial submission:', JSON.stringify(data, null, 2));

            // Show success
            document.getElementById('formContainer').style.display = 'none';
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('quickStart').style.display = 'none';
            document.getElementById('sectionDivider').style.display = 'none';
            document.getElementById('successMessage').classList.add('visible');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
